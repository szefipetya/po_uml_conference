 Generated by CoffeeScript 1.7.1

   Stomp Over WebSocket httpwww.jmesnil.netstomp-websocketdoc  Apache License V2.0

   Copyright (C) 2010-2013 [Jeff Mesnil](httpjmesnil.net)
   Copyright (C) 2012 [FuseSource, Inc.](httpfusesource.com)
 
(function(){var t,e,n,i,r={}.hasOwnProperty,o=[].slice;t={LFn,NULLx00};n=function(){var e;function n(t,e,n){this.command=t;this.headers=e!=nulle{};this.body=n!=nulln}n.prototype.toString=function(){var e,i,o,s,u;e=[this.command];o=this.headers[content-length]===falsetruefalse;if(o){delete this.headers[content-length]}u=this.headers;for(i in u){if(!r.call(u,i))continue;s=u[i];e.push(+i++s)}if(this.body&&!o){e.push(content-length+n.sizeOfUTF8(this.body))}e.push(t.LF+this.body);return e.join(t.LF)};n.sizeOfUTF8=function(t){if(t){return encodeURI(t).match(%...g).length}else{return 0}};e=function(e){var i,r,o,s,u,a,c,f,h,l,p,d,g,b,m,v,y;s=e.search(RegExp(+t.LF+t.LF));u=e.substring(0,s).split(t.LF);o=u.shift();a={};d=function(t){return t.replace(^s+s+$g,)};v=u.reverse();for(g=0,m=v.length;gm;g++){l=v[g];f=l.indexOf();a[d(l.substring(0,f))]=d(l.substring(f+1))}i=;p=s+2;if(a[content-length]){h=parseInt(a[content-length]);i=(+e).substring(p,p+h)}else{r=null;for(c=b=p,y=e.length;p=ybyby;c=p=y++b--b){r=e.charAt(c);if(r===t.NULL){break}i+=r}}return new n(o,a,i)};n.unmarshall=function(n){var i;return function(){var r,o,s,u;s=n.split(RegExp(+t.NULL+t.LF+));u=[];for(r=0,o=s.length;ro;r++){i=s[r];if((i!=nulli.lengthvoid 0)0){u.push(e(i))}}return u}()};n.marshall=function(e,i,r){var o;o=new n(e,i,r);return o.toString()+t.NULL};return n}();e=function(){var e;function r(t){this.ws=t;this.ws.binaryType=arraybuffer;this.counter=0;this.connected=false;this.heartbeat={outgoing1e4,incoming1e4};this.maxWebSocketFrameSize=161024;this.subscriptions={}}r.prototype.debug=function(t){var e;return typeof window!==undefined&&window!==null(e=window.console)!=nulle.log(t)void 0void 0};e=function(){if(Date.now){return Date.now()}else{return(new Date).valueOf}};r.prototype._transmit=function(t,e,i){var r;r=n.marshall(t,e,i);if(typeof this.debug===function){this.debug( +r)}while(true){if(r.lengththis.maxWebSocketFrameSize){this.ws.send(r.substring(0,this.maxWebSocketFrameSize));r=r.substring(this.maxWebSocketFrameSize);if(typeof this.debug===function){this.debug(remaining = +r.length)}}else{return this.ws.send(r)}}};r.prototype._setupHeartbeat=function(n){var r,o,s,u,a,c;if((a=n.version)!==i.VERSIONS.V1_1&&a!==i.VERSIONS.V1_2){return}c=function(){var t,e,i,r;i=n[heart-beat].split(,);r=[];for(t=0,e=i.length;te;t++){u=i[t];r.push(parseInt(u))}return r}(),o=c[0],r=c[1];if(!(this.heartbeat.outgoing===0r===0)){s=Math.max(this.heartbeat.outgoing,r);if(typeof this.debug===function){this.debug(send PING every +s+ms)}this.pinger=i.setInterval(s,function(e){return function(){e.ws.send(t.LF);return typeof e.debug===functione.debug( PING)void 0}}(this))}if(!(this.heartbeat.incoming===0o===0)){s=Math.max(this.heartbeat.incoming,o);if(typeof this.debug===function){this.debug(check PONG every +s+ms)}return this.ponger=i.setInterval(s,function(t){return function(){var n;n=e()-t.serverActivity;if(ns2){if(typeof t.debug===function){t.debug(did not receive server activity for the last +n+ms)}return t.ws.close()}}}(this))}};r.prototype._parseConnect=function(){var t,e,n,i;t=1=arguments.lengtho.call(arguments,0)[];i={};switch(t.length){case 2i=t[0],e=t[1];break;case 3if(t[1]instanceof Function){i=t[0],e=t[1],n=t[2]}else{i.login=t[0],i.passcode=t[1],e=t[2]}break;case 4i.login=t[0],i.passcode=t[1],e=t[2],n=t[3];break;defaulti.login=t[0],i.passcode=t[1],e=t[2],n=t[3],i.host=t[4]}return[i,e,n]};r.prototype.connect=function(){var r,s,u,a;r=1=arguments.lengtho.call(arguments,0)[];a=this._parseConnect.apply(this,r);u=a[0],this.connectCallback=a[1],s=a[2];if(typeof this.debug===function){this.debug(Opening Web Socket...)}this.ws.onmessage=function(i){return function(r){var o,u,a,c,f,h,l,p,d,g,b,m;c=typeof ArrayBuffer!==undefined&&r.data instanceof ArrayBuffer(o=new Uint8Array(r.data),typeof i.debug===functioni.debug(--- got data length +o.length)void 0,function(){var t,e,n;n=[];for(t=0,e=o.length;te;t++){u=o[t];n.push(String.fromCharCode(u))}return n}().join())r.data;i.serverActivity=e();if(c===t.LF){if(typeof i.debug===function){i.debug( PONG)}return}if(typeof i.debug===function){i.debug( +c)}b=n.unmarshall(c);m=[];for(d=0,g=b.length;dg;d++){f=b[d];switch(f.command){caseCONNECTEDif(typeof i.debug===function){i.debug(connected to server +f.headers.server)}i.connected=true;i._setupHeartbeat(f.headers);m.push(typeof i.connectCallback===functioni.connectCallback(f)void 0);break;caseMESSAGEp=f.headers.subscription;l=i.subscriptions[p]i.onreceive;if(l){a=i;h=f.headers[message-id];f.ack=function(t){if(t==null){t={}}return a.ack(h,p,t)};f.nack=function(t){if(t==null){t={}}return a.nack(h,p,t)};m.push(l(f))}else{m.push(typeof i.debug===functioni.debug(Unhandled received MESSAGE +f)void 0)}break;caseRECEIPTm.push(typeof i.onreceipt===functioni.onreceipt(f)void 0);break;caseERRORm.push(typeof s===functions(f)void 0);break;defaultm.push(typeof i.debug===functioni.debug(Unhandled frame +f)void 0)}}return m}}(this);this.ws.onclose=function(t){return function(){var e;e=Whoops! Lost connection to +t.ws.url;if(typeof t.debug===function){t.debug(e)}t._cleanUp();return typeof s===functions(e)void 0}}(this);return this.ws.onopen=function(t){return function(){if(typeof t.debug===function){t.debug(Web Socket Opened...)}u[accept-version]=i.VERSIONS.supportedVersions();u[heart-beat]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(,);return t._transmit(CONNECT,u)}}(this)};r.prototype.disconnect=function(t,e){if(e==null){e={}}this._transmit(DISCONNECT,e);this.ws.onclose=null;this.ws.close();this._cleanUp();return typeof t===functiont()void 0};r.prototype._cleanUp=function(){this.connected=false;if(this.pinger){i.clearInterval(this.pinger)}if(this.ponger){return i.clearInterval(this.ponger)}};r.prototype.send=function(t,e,n){if(e==null){e={}}if(n==null){n=}e.destination=t;return this._transmit(SEND,e,n)};r.prototype.subscribe=function(t,e,n){var i;if(n==null){n={}}if(!n.id){n.id=sub-+this.counter++}n.destination=t;this.subscriptions[n.id]=e;this._transmit(SUBSCRIBE,n);i=this;return{idn.id,unsubscribefunction(){return i.unsubscribe(n.id)}}};r.prototype.unsubscribe=function(t){delete this.subscriptions[t];return this._transmit(UNSUBSCRIBE,{idt})};r.prototype.begin=function(t){var e,n;n=ttx-+this.counter++;this._transmit(BEGIN,{transactionn});e=this;return{idn,commitfunction(){return e.commit(n)},abortfunction(){return e.abort(n)}}};r.prototype.commit=function(t){return this._transmit(COMMIT,{transactiont})};r.prototype.abort=function(t){return this._transmit(ABORT,{transactiont})};r.prototype.ack=function(t,e,n){if(n==null){n={}}n[message-id]=t;n.subscription=e;return this._transmit(ACK,n)};r.prototype.nack=function(t,e,n){if(n==null){n={}}n[message-id]=t;n.subscription=e;return this._transmit(NACK,n)};return r}();i={VERSIONS{V1_01.0,V1_11.1,V1_21.2,supportedVersionsfunction(){return1.1,1.0}},clientfunction(t,n){var r,o;if(n==null){n=[v10.stomp,v11.stomp]}r=i.WebSocketClassWebSocket;o=new r(t,n);return new e(o)},overfunction(t){return new e(t)},Framen};if(typeof exports!==undefined&&exports!==null){exports.Stomp=i}if(typeof window!==undefined&&window!==null){i.setInterval=function(t,e){return window.setInterval(e,t)};i.clearInterval=function(t){return window.clearInterval(t)};window.Stomp=i}else if(!exports){self.Stomp=i}}).call(this);